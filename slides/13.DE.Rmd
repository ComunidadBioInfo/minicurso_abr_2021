---
title: '13: Expresión Diferencial'
author: "Ana BVA"
date: "10/3/2021"
output:
  xaringan::moon_reader:
    css: ["default", "default-fonts", "hygge"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      beforeInit: "macros.js"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


```{css, echo = FALSE}
/* From https://github.com/yihui/xaringan/issues/147  */
.scroll-output {
  height: 80%;
  overflow-y: scroll;
}
/* https://stackoverflow.com/questions/50919104/horizontally-scrollable-output-on-xaringan-slides */
pre {
  max-width: 100%;
  overflow-x: scroll;
}

```


## Análisis de expresión diferencial (DE)

Paso para obtener cuales son los genes que varían entre las condiciones

```{r, out.width = "750px",fig.align='center'}
knitr::include_graphics("https://raw.githubusercontent.com/hbctraining/DGE_workshop/master/img/de_theory.png")
```

---

## Pasos en el DE

```{r, out.width = "350px",fig.align='center'}
knitr::include_graphics("https://github.com/hbctraining/DGE_workshop/raw/master/img/deseq2_workflow_separate.png")
```

---
## Dispersión

La dispersión es una medida de la variabilidad de los datos como (varianza, sd, etc.). En `DESeq2` se utiliza `α`:

$$ \alpha \propto 1/mean $$ 
$$ \alpha \propto variance $$ 

Así que **La dispersión es mayor para cuentas más bajas y menor para cuenas más altas**. 

Y la **dispersión refleja la varianza**.

.content-box-red[
`DESea2` asume que los genes con similar expresión tienen similar dispersión
]

---

## Ajustando la dispersión


```{r, out.width = "450px",fig.align='center'}
knitr::include_graphics("https://github.com/hbctraining/DGE_workshop/raw/master/img/deseq_dispersion1.png")
```


---

## Reduciendo la dispersión

```{r, out.width = "750px",fig.align='center'}
knitr::include_graphics("https://github.com/hbctraining/DGE_workshop/raw/master/img/deseq_dispersion2.png")
```


---

## Ejercicio

.scroll-output[

La librería de `DESeq2` normaliza y realiza el análisis de expresión diferencial en una sola función. Así que ya realizamos el análisis, vamos a verlo:

```{r include=FALSE}
info <- read.delim(here::here("output/salmon_quants/metadata.txt"))
info$names <- info$Unique_id
dir <- file.path(here::here("output/salmon_quants"))
info$files <- file.path(dir,paste0(info$Sample,"_quant"),"quant.sf")
library("tximeta")
gse <- tximeta(info)
```


```{r echo=TRUE, message=FALSE, warning=FALSE}
library("DESeq2")
library("dplyr")
library("ggplot2")
```

```{r echo=TRUE}
gse$Condition <- factor(gse$Condition)
table(gse$Condition)

dds <- DESeqDataSet(gse, design = ~ Condition)
dds <- DESeq(dds)
```

Para ver los resultados podemos usar la función `results`

```{r}
res <- results(dds)
res
summary(res)
```

Para ver que hay en cada columna:
```{r}
mcols(res, use.names = TRUE)
```

Podemos hacer cortes:
```{r}
resLFC1 <- results(dds, lfcThreshold=1)
table(resLFC1$padj < 0.1)
```


]





