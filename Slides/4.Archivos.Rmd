---
title: "4.Archivos"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
date: "`r Sys.Date()`"
---

# Flujo de trabajo

```{r, out.width="550px", fig.align='center', echo = F}
knitr::include_graphics("../Images/RNAseq_workflow.png")
```

---

# FastQ

--

- Derivado del formato FASTA

--

- Id secuencia + **Calidad**

--

- Generalmente no está comprimido (.fastq) > comprimir (.fastq.gz)

--

- Comprende 4 líneas por secuencia:
  * @ ID del read + información de la corrida
  * Secuencia 
  * Símbolo "+"
  * Calidad (Escala **Phred** y código **ASCII**)
  
---

# FastQ  
## Identificador

--

- El identificador de la secuencia es la primera línea del archivo .fastq

--

- Plataformas de Illumina superiores a 1.8 contienen la siguiente información:

--

**@machneID:run number:flowCell ID:lane:tile:read:control number:index**

```{bash echo = F}
gzcat ../Data/s1_R1.fastq.gz | head -n 1
```

---

# FastQ
## Calidad

La calidad de cada base secuenciada, en la escala **Phred**, se calcula de acuerdo la siguiente ecuación:


$$Q = -10 * log10(p)$$

--

Q = Calidad 

--

p = Probabilidad de que el base call sea incorrecto

--

Valores de **p** cercanos a cero -> Alta calidad

--

¿Cuál es la calidad si el valor p del basecall es de 0.01?

--

$$Q = -10 * log10(0.01) = -10 * -2 = 20$$

---
# Fastq
## Calidad

```{r, out.width="700px", fig.align='center', echo = F}
knitr::include_graphics("../Images/Fastqc.png")
```


---
# FastQ
## Calidad

--

- Para evitar colocar los valores numéricos de la calidad en el archivo .fastq y saturarlo de información -> **[ASCII](https://www.ascii-code.com/)**

--

- Phred + 33 -> Plataformas de Illumina a partir de 1.8 (símbolos especiales + alfanuméricos)

--

- Phred + 64 -> Plataformas de Illumina anteriores a 1.8


```{r, out.width="400px", fig.align='center', echo = F}
knitr::include_graphics("../Images/ASCII0.png")
```


```{r, out.width="400px", fig.align='center', echo = F}
knitr::include_graphics("../Images/ASCII33.png")
```

---

# FastQ


```{r, out.width="700px", fig.align='center',echo = F}
knitr::include_graphics("../Images/Fastq.png")
```

---

# SAM/BAM

--

- De manera posterior al alineamiento se generan archivos **"Sequence Alignment Map"** -> **SAM**

--

- Archivos delimitados por tabuladores (TAB)

--

- Convertidos a valores binarios como **"Binary Alignment Map"** -> **BAM**

--

- **BAM** -> Mayor espacio en disco -> Acceso aleatorio más eficiente

--

- Las secuencias en formato BAM se pueden ordenar por coordenadas

--

- Conversion entre formatos [SamTools!](https://github.com/samtools/samtools)

---

# SAM/BAM

- Los archivos en formato **SAM** se dividen en dos secciones:

--

- **HEADER**: Información general del archivo

--

- **ALIGNMENT**: Información relacionada con el alineamiento de los reads

--
```{r, out.width="550px", fig.align='center', echo = F}
knitr::include_graphics("../Images/SAM-BAM.png")
```

---


```{r, out.width="600px", fig.align='center', echo = F}
knitr::include_graphics("../Images/Header.png")
```

--

- La sección HEADER incuye unformación sobre cómo se generó el alineamiento y su almacenamiento

--

- **Todas** las líneas del HEADER están separadas por tabuladores

--

- La estructura general de las líneas es la siguiente:

   @ TAG:VALUE

* TAG: Código de dos letras -> Contenido
* VALUE: Valores del TAG

---

# SAM/BAM
##HEADER

Ejemplos de diferentes **TAG**:

--

- @HD -> Metadatos del alineamiento

--

- @SQ -> Datos de la secuencia de referencia

--

- @RG -> Grupo de lecturas 

--

- @PG -> Información del alineador y el código del alineamiento

---

```{r, out.width="600px", fig.align='center', echo = F}
knitr::include_graphics("../Images/Alignment.png")
```

--

Esta sección procede al **HEADER** y contiene:

--

- Cada línea corresponde a una lectura alineada

--

- Para cada lectura se muestran los resultados de los siguientes campos obligatorios:

```{r, out.width="400px", fig.align='center', echo = F}
knitr::include_graphics("../Images/Alignment2.png")
```


---

# SAM/BAM
## FLAG

--

- Los valores del FLAG contestan preguntas relacionadas con el alineamiento del read

--

- Sí = 1, No = 0

--

- Cada respuesta se encuentra codificada en valores **binarios, decimales y hexadecimales**

--

- Información útil para lecturas pareadas -> ¿La lectura es pareada? 
¿Ambos reads alinearon adecuadamente?

---

# SAM/BAM
## FLAG

```{r, out.width="600px", fig.align='center', echo = F}
knitr::include_graphics("../Images/flag.png")
```

---

# SAM/BAM
## Concise Idiosyncratic Gapped Alignment Report (CIGAR)

- Almacena información relacionada con las operaciones necesarias para alinear el read
- Se reporta con valores alfanuméricos:

--
  * M -> Alineamiento correcto
  * I -> Inserción comparado con la referencia
  * D -> Deleción comparado con la referencia
  * N -> Región con corrimiento (intrón)
  * S -> Soft clipping
  * H -> Hard clipping
  * P -> Padding o mutación silenciosa

--
---
 
# SAM/BAM
## CIGAR

```{r, out.width="600px", fig.align='center', echo = F}
knitr::include_graphics("../Images/cigar.png")
```


